{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///D:/agntha%20Project/next-url-shortener/app/api/links/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport fs from \"fs/promises\";\r\nimport path from \"path\";\r\n\r\nconst DATA_FILE = path.join(process.cwd(), \"data\", \"links.json\");\r\nconst CODE_REGEX = /^[A-Za-z0-9]{6,8}$/;\r\n\r\nasync function readStore() {\r\n  try { const raw = await fs.readFile(DATA_FILE, \"utf8\"); return JSON.parse(raw); } catch { return []; }\r\n}\r\nasync function writeStore(data: any[]) {\r\n  await fs.mkdir(path.dirname(DATA_FILE), { recursive: true });\r\n  await fs.writeFile(DATA_FILE, JSON.stringify(data, null, 2), \"utf8\");\r\n}\r\nfunction genCode(len=6){ const chars=\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\"; let s=\"\"; for(let i=0;i<len;i++) s+=chars[Math.floor(Math.random()*chars.length)]; return s; }\r\nfunction validateUrl(u:string){ try{ const url = new URL(u); return url.protocol === \"http:\" || url.protocol === \"https:\" }catch{return false}}\r\n\r\nexport async function GET() {\r\n  const items = await readStore();\r\n  return NextResponse.json(items);\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  const body = await req.json().catch(()=>({}));\r\n  const url = (body.url || \"\").trim();\r\n  let code = body.code ? String(body.code).trim() : \"\";\r\n\r\n  if (!url || !validateUrl(url)) return NextResponse.json({ error: \"Invalid or missing url (include http/https)\" }, { status: 400 });\r\n\r\n  const store = await readStore();\r\n\r\n  if (code) {\r\n    if (!CODE_REGEX.test(code)) return NextResponse.json({ error: \"Custom code must be 6-8 alphanumeric\" }, { status: 400 });\r\n    if (store.find((s:any)=>s.code===code)) return NextResponse.json({ error: \"Code exists\" }, { status: 409 });\r\n  } else {\r\n    let attempts=0;\r\n    do { code = genCode(6); attempts++; if(attempts>50) code = genCode(8); } while (store.find((s:any)=>s.code===code));\r\n  }\r\n\r\n  const created = { code, url, clicks:0, lastClicked:null, createdAt: new Date().toISOString() };\r\n  store.push(created);\r\n  await writeStore(store);\r\n\r\n  const origin = process.env.NEXT_PUBLIC_BASE_URL || new URL(req.url).origin;\r\n  const shortUrl = `${origin.replace(/\\/$/,\"\")}/${code}`;\r\n  return NextResponse.json({ ...created, shortUrl }, { status: 201 });\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AACnD,MAAM,aAAa;AAEnB,eAAe;IACb,IAAI;QAAE,MAAM,MAAM,MAAM,gIAAE,CAAC,QAAQ,CAAC,WAAW;QAAS,OAAO,KAAK,KAAK,CAAC;IAAM,EAAE,OAAM;QAAE,OAAO,EAAE;IAAE;AACvG;AACA,eAAe,WAAW,IAAW;IACnC,MAAM,gIAAE,CAAC,KAAK,CAAC,4GAAI,CAAC,OAAO,CAAC,YAAY;QAAE,WAAW;IAAK;IAC1D,MAAM,gIAAE,CAAC,SAAS,CAAC,WAAW,KAAK,SAAS,CAAC,MAAM,MAAM,IAAI;AAC/D;AACA,SAAS,QAAQ,MAAI,CAAC;IAAG,MAAM,QAAM;IAAkE,IAAI,IAAE;IAAI,IAAI,IAAI,IAAE,GAAE,IAAE,KAAI,IAAK,KAAG,KAAK,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAG,MAAM,MAAM,EAAE;IAAE,OAAO;AAAG;AACpM,SAAS,YAAY,CAAQ;IAAG,IAAG;QAAE,MAAM,MAAM,IAAI,IAAI;QAAI,OAAO,IAAI,QAAQ,KAAK,WAAW,IAAI,QAAQ,KAAK;IAAS,EAAC,OAAK;QAAC,OAAO;IAAK;AAAC;AAEvI,eAAe;IACpB,MAAM,QAAQ,MAAM;IACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;AAC3B;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;IAC3C,MAAM,MAAM,CAAC,KAAK,GAAG,IAAI,EAAE,EAAE,IAAI;IACjC,IAAI,OAAO,KAAK,IAAI,GAAG,OAAO,KAAK,IAAI,EAAE,IAAI,KAAK;IAElD,IAAI,CAAC,OAAO,CAAC,YAAY,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAA8C,GAAG;QAAE,QAAQ;IAAI;IAEhI,MAAM,QAAQ,MAAM;IAEpB,IAAI,MAAM;QACR,IAAI,CAAC,WAAW,IAAI,CAAC,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuC,GAAG;YAAE,QAAQ;QAAI;QACtH,IAAI,MAAM,IAAI,CAAC,CAAC,IAAQ,EAAE,IAAI,KAAG,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAc,GAAG;YAAE,QAAQ;QAAI;IAC3G,OAAO;QACL,IAAI,WAAS;QACb,GAAG;YAAE,OAAO,QAAQ;YAAI;YAAY,IAAG,WAAS,IAAI,OAAO,QAAQ;QAAI,QAAS,MAAM,IAAI,CAAC,CAAC,IAAQ,EAAE,IAAI,KAAG,MAAO;IACtH;IAEA,MAAM,UAAU;QAAE;QAAM;QAAK,QAAO;QAAG,aAAY;QAAM,WAAW,IAAI,OAAO,WAAW;IAAG;IAC7F,MAAM,IAAI,CAAC;IACX,MAAM,WAAW;IAEjB,MAAM,SAAS,QAAQ,GAAG,CAAC,oBAAoB,IAAI,IAAI,IAAI,IAAI,GAAG,EAAE,MAAM;IAC1E,MAAM,WAAW,GAAG,OAAO,OAAO,CAAC,OAAM,IAAI,CAAC,EAAE,MAAM;IACtD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,GAAG,OAAO;QAAE;IAAS,GAAG;QAAE,QAAQ;IAAI;AACnE"}}]
}